# shellcheck disable=SC2148
set -e
[[ -n ${ZSH_VERSION} ]]  # Only zsh should source this file.

[[ ${TERM} == xterm ]] && export TERM=screen-256color

# Initialize completion.
autoload -Uz compinit && compinit

# Initialize prompt.
autoload -Uz promptinit && promptinit
unset RPROMPT
prompt off

# Enable colors.
autoload -Uz colors && colors

# Re-evaluate prompt on every command.
setopt prompt_subst

# Define the prompt here.
export PROMPT="%F{yellow}%~%f %(1j.%K{052} %F{white}%j%f %k .)%(?..%F{red})%%%f "

# History.
# shellcheck disable=SC2034
SAVEHIST=50000
HISTSIZE=99000
HISTFILE=${HOME}/.zsh_history
setopt append_history
setopt extended_history  # Timestamps and duration.
setopt hist_expire_dups_first
setopt hist_ignore_dups
setopt hist_ignore_space
setopt hist_verify
setopt inc_append_history  # Use `fc -RI' to import commands.

# Define some aliases.
if [[ $OSTYPE == darwin* ]]; then
    alias ls='ls -G'
else
    alias ls='ls --color=auto'
fi
alias l='ls'
alias ll='ls -l'

# agp is ag+pager
alias agp='ag --pager="less --no-init --quit-if-one-screen --RAW-CONTROL-CHARS" --color'

# Emacs style bindings (for Home/End keys...)
bindkey -e

# Define key bindings here.
bindkey '^R' history-incremental-search-backward
bindkey '^[[1;5C' forward-word   # Ctrl-RightArrow
bindkey '\ef' forward-word       # Alt-f
bindkey '^[[1;5D' backward-word  # Ctrl-LeftArrow
bindkey '\eb' backward-word      # Alt-b
bindkey '\e.' insert-last-word   # Alt-.

[[ -f $HOME/.zshrc.local ]] && source "$HOME/.zshrc.local"

set +e

export PATH=$HOME/bin:$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH

if [[ -d $HOME/.pyenv ]]; then
    export PATH=$HOME/.pyenv/bin:$PATH
    eval "$(pyenv init -)"
fi
